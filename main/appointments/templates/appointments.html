{% extends 'base.html' %} {% block encabezado %}
<h1>Nuestras sesiones y Citas</h1>
{% endblock %} {% block contenido %}
<h2>Información de Masajes</h2>
{% if appointments %} {% if user.is_staff %}
<p>
  <a href="/appointments/create/" class="btn btn-primary">Crear sesion</a>
</p>
{% endif %}
<ul class="appointments-list">
  {% for appointment in appointments %}
  <li>
    <h3>{{ appointment.nombre|default:appointment.name }}</h3>
    {% if appointment.descripcion or appointment.description %}
    <p>{{ appointment.descripcion|default:appointment.description }}</p>
    {% endif %} {% if appointment.duracion or appointment.duration %}
    <p>Duración: {{ appointment.duracion|default:appointment.duration }} min</p>
    {% endif %} {% if appointment.precio or appointment.price %}
    <p>
      Precio:
      <span
        class="price"
        data-price="{{ appointment.precio|default:appointment.price }}"
        data-discount="{{ appointment.discount }}"
        data-enddiscount="{% if appointment.endDiscount %}{{ appointment.endDiscount|date:'Y-m-d-H-i' }}{% endif %}"
        >{{ appointment.precio|default:appointment.price }} €</span
      >
    </p>
    {% endif %} {% if user.is_staff %}
    <p>
      <a
        href="/appointments/update/{{ appointment.id }}/"
        class="btn btn-primary"
      >
        Editar sesión
      </a>
    </p>
    <p>
      <a
        href="/appointments/create_discount/{{ appointment.id }}/"
        class="btn btn-secondary"
      >
        Crear descuento
      </a>
    </p>
    <p>
      <a
        href="/appointments/delete/{{ appointment.id }}/"
        class="btn btn-danger"
      >
        Borrar sesión
      </a>
    </p>
    {% endif %}
  </li>
  {% endfor %}
</ul>
{% else %}
<p>No hay sesiones disponibles.</p>
{% endif %}

<h2>Reserva tu Cita</h2>

<div
  class="calendly-inline-widget"
  data-url="https://calendly.com/natursur/fernando-escalona"
  style="min-width: 320px; height: 700px"
></div>

<script
  type="text/javascript"
  src="https://assets.calendly.com/assets/external/widget.js"
  async
></script>
<script>
<<<<<<< HEAD
  (function () {
    function parseDateYMD(s) {
      if (!s) return null;
      var parts = String(s).split('-');
      if (parts.length < 3) return null;
      var y = parseInt(parts[0], 10);
      var m = parseInt(parts[1], 10) - 1;
      var d = parseInt(parts[2], 10);
      var H = 0;
      var i = 0;
      if (parts.length > 3) {
        H = parseInt(parts[3], 10);
        if (isNaN(H)) H = 0;
      }
      if (parts.length > 4) {
        i = parseInt(parts[4], 10);
        if (isNaN(i)) i = 0;
      }
      if (isNaN(y) || isNaN(m) || isNaN(d) || isNaN(H) || isNaN(i)) return null;
      return new Date(y, m, d, H, i);
    }

    var today = new Date();

    document.querySelectorAll('.price').forEach(function (el) {
      var rawPrice = el.dataset.price || '';
      var rawDiscount = el.dataset.discount || '';
      var rawEnd = el.dataset.enddiscount || '';

      function toNumber(s) {
        if (!s && s !== 0) return NaN;
        var t = String(s).trim().replace(/\s+/g, '').replace(/,/g, '.').replace(/[^0-9.\-]/g, '');
        return t === '' ? NaN : parseFloat(t);
      }

      var price = toNumber(rawPrice);
      var discount = toNumber(rawDiscount);
      var endDate = parseDateYMD(rawEnd);

      var active = false;
      if (endDate && !isNaN(endDate.getTime()) && endDate >= today && !isNaN(discount)) {
        active = true;
      }

      if (active) {
        if (!isNaN(price) && !isNaN(discount)) {
          el.innerHTML = '<del>' + price.toFixed(2) + ' €</del> ' + discount.toFixed(2) + ' €';
        } else if (!isNaN(discount)) {
          el.textContent = discount.toFixed(2) + ' €';
        }
      } else {
        if (!isNaN(price)) {
          el.textContent = price.toFixed(2) + ' €';
        } else {
          el.textContent = rawPrice;
        }
      }
    });
  })();
</script>
=======
  (function () {
    function parseDateYMD(s) {
      if (!s) return null;
      var parts = String(s).split('-');
      if (parts.length < 3) return null;
      var y = parseInt(parts[0], 10);
      var m = parseInt(parts[1], 10) - 1;
      var d = parseInt(parts[2], 10);
      if (isNaN(y) || isNaN(m) || isNaN(d)) return null;
      return new Date(y, m, d);
    }

    var today = new Date();

    document.querySelectorAll('.price').forEach(function (el) {
      var rawPrice = el.dataset.price || '';
      var rawDiscount = el.dataset.discount || '';
      var rawEnd = el.dataset.enddiscount || '';

      function toNumber(s) {
        if (!s && s !== 0) return NaN;
        var t = String(s).trim().replace(/\s+/g, '').replace(/,/g, '.').replace(/[^0-9.\-]/g, '');
        return t === '' ? NaN : parseFloat(t);
      }

      var price = toNumber(rawPrice);
      var discount = toNumber(rawDiscount);
      var endDate = parseDateYMD(rawEnd);

      var active = false;
      if (endDate && !isNaN(endDate.getTime()) && endDate >= today && !isNaN(discount)) {
        active = true;
      }

      if (active) {
        if (!isNaN(price) && !isNaN(discount)) {
          el.innerHTML = '<del>' + price.toFixed(2) + ' €</del> ' + discount.toFixed(2) + ' €';
        } else if (!isNaN(discount)) {
          el.textContent = discount.toFixed(2) + ' €';
        }
      } else {
        
        if (!isNaN(price)) {
          el.textContent = price.toFixed(2) + ' €';
        } else {
          
          el.textContent = rawPrice;
        }
      }
    });
  })();
</script>

el script este no tiene en cuenta los minutos y horas actuales solo los dias
>>>>>>> 93ceee7087a20c8720309161c4b29bda2325fb44
{% endblock %}
