{% extends 'base.html' %}
{% load static %}

{% block title %}Servicios y Tarifas | NaturSur{% endblock title %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'styles/appointments.css' %}">
{% endblock extra_head %}

{% block contenido %}
<div class="services-page">

    <div class="services-types">
        <h1>Nuestros Servicios</h1>
        <p>Mejora tu calidad de vida con masajes de osteopatía, masajes biomagnético, técnicas emocionales y asesoramiento nutricional. Encuentra el equilibrio que tu cuerpo y mente necesitan.</p>
    </div>
    
    
    <section class="services-showcase">
        <div class="showcase-card">
            <span class="material-icons card-icon">spa</span>
            <h3>Masaje y Osteopatía</h3>
            <p>Terapias manuales para aliviar tensiones, corregir desajustes corporales y mejorar tu bienestar físico general.</p>
        </div>

        <div class="showcase-card">
            <span class="material-icons card-icon">device_thermostat</span>
            <h3>Par Biomagnético</h3>
            <p>Aplicación de imanes terapéuticos para equilibrar el pH corporal y apoyar la recuperación natural del organismo.</p>
        </div>

        <div class="showcase-card">
            <span class="material-icons card-icon">psychology</span>
            <h3>Técnicas Emocionales</h3>
            <p>Herramientas efectivas para gestionar emociones, reducir estrés y promover un estado mental más equilibrado.</p>
        </div>

        <div class="showcase-card">
            <span class="material-icons card-icon">local_dining</span>
            <h3>Asesoramiento Nutricional</h3>
            <p>Guía profesional para adoptar hábitos alimenticios saludables y alcanzar tus objetivos de salud y energía.</p>
        </div>
    </section>


    <div class="services-intro">
        <h1>Nuestras Sesiones</h1>
        <p>Encuentra el equilibrio perfecto entre cuerpo y mente con nuestros tratamientos especializados.</p>
    </div>

    {% if user.is_staff %}
    <div class="admin-actions-bar">
        <a href="{% url 'create_appointment' %}" class="btn-create">
            <span class="material-icons">add</span> Crear Nueva Sesión
        </a>
    </div>
    {% endif %}

    <div class="services-grid">
        {% for appointment in appointments %}
        
        <article class="service-card {% if appointment.premium %}premium{% endif %}">
            
            {% if appointment.premium %}
            <div class="premium-badge">
                <span class="material-icons" style="font-size: 12px; vertical-align: middle;">star</span> Premium
            </div>
            {% endif %}

            <div class="card-header-service">
                <div class="duration-wrapper">
                    <span class="material-symbols">timer</span>
                    <span class="duration-time">{{ appointment.duration }}</span>
                    <span class="duration-unit">min</span>
                </div>
            </div>

            <div class="card-body-service">
                <h2 class="service-name">{{ appointment.name }}</h2>
                <div class="separator"></div>
                
                <p class="service-description">
                    {% if appointment.description %}
                        {{ appointment.description|truncatechars:120 }}
                    {% else %}
                        Una experiencia renovadora diseñada para tu bienestar integral y relajación profunda.
                    {% endif %}
                </p>

                <div class="price-container">
                    {% if appointment.discount > 0 %}
                        <span class="price-original">{{ appointment.price }}€</span>
                        <span class="price-current price-discount-active">
                             Oferta: {{ appointment.discount }}€ 
                        </span>
                        <div class="discount-tag">Ahorras {{ appointment.total_money_save }}€</div>
                        <small style="font-size: 0.7rem; color: #777;">Hasta: {{ appointment.endDiscount|date:"d M Y" }}</small>
                    {% else %}
                        <span class="price-current">{{ appointment.price }}€</span>
                    {% endif %}
                </div>
            </div>

            {% if user.is_staff %}
            <div class="staff-controls">
                <a href="{% url 'update_appointment' appointment.id %}" class="btn-staff btn-edit" title="Editar">
                    <span class="material-icons">edit</span>
                </a>
                <a href="{% url 'create_discount' appointment.id %}" class="btn-staff btn-discount" title="Gestionar Descuento">
                    <span class="material-icons">percent</span>
                </a>
                <a href="{% url 'delete_appointment' appointment.id %}" class="btn-staff btn-delete" title="Eliminar" onclick="return confirm('¿Estás seguro de que deseas eliminar este servicio?');">
                    <span class="material-icons">delete</span>
                </a>
            </div>
            {% endif %}

        </article>
        {% empty %}
            <p style="text-align: center; grid-column: 1/-1; padding: 50px;">No hay servicios disponibles en este momento.</p>
        {% endfor %}
    </div>

    <div class="calendly-inline-widget" data-url="https://calendly.com/natursur/fernando-escalona" style="min-width: 320px; height: 700px"
    ></div>

    <script type="text/javascript" src="https://assets.calendly.com/assets/external/widget.js" async
    ></script>

</div>
{% endblock contenido %}