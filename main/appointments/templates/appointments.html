{% extends 'base.html' %}
{% load static %}

{% block title %}Servicios y Tarifas | NaturSur{% endblock title %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'styles/appointments.css' %}">
{% endblock extra_head %}

{% block contenido %}
<div class="services-page">
    
    <header class="services-header">
        <h1>Nuestras Sesiones</h1>
        <p>Encuentra el equilibrio perfecto entre cuerpo y mente con nuestros tratamientos especializados.</p>
    </header>

    {% if user.is_staff %}
    <div class="admin-actions-bar">
        <a href="{% url 'create_appointment' %}" class="btn-create">
            <span class="material-icons">add</span> Crear Nueva Sesión
        </a>
    </div>
    {% endif %}

    <div class="services-grid">
        {% for appointment in appointments %}
        
        <article class="service-card {% if appointment.premium %}premium{% endif %}">
            
            {% if appointment.premium %}
            <div class="premium-badge">
                <span class="material-icons" style="font-size: 12px; vertical-align: middle;">star</span> Premium
            </div>
            {% endif %}

            <div class="card-header-service">
                <div class="duration-wrapper">
                    <span class="material-symbols">timer</span>
                    <span class="duration-time">{{ appointment.duration }}</span>
                    <span class="duration-unit">min</span>
                </div>
            </div>

            <div class="card-body-service">
                <h2 class="service-name">{{ appointment.name }}</h2>
                <div class="separator"></div>
                
                <p class="service-description">
                    {% if appointment.description %}
                        {{ appointment.description|truncatechars:120 }}
                    {% else %}
                        Una experiencia renovadora diseñada para tu bienestar integral y relajación profunda.
                    {% endif %}
                </p>

                <div class="price-container">
                    {% if appointment.discount > 0 %}
                        <span class="price-original">{{ appointment.price }}€</span>
                        <span class="price-current price-discount-active">
                             Oferta: {{ appointment.discount }}€ 
                        </span>
                        <div class="discount-tag">Ahorras {{ appointment.total_money_save }}€</div>
                        <small style="font-size: 0.7rem; color: #777;">Hasta: {{ appointment.endDiscount|date:"d M Y" }}</small>
                    {% else %}
                        <span class="price-current">{{ appointment.price }}€</span>
                    {% endif %}
                </div>
            </div>

            {% if user.is_staff %}
            <div class="staff-controls">
                <a href="{% url 'update_appointment' appointment.id %}" class="btn-staff btn-edit" title="Editar">
                    <span class="material-icons">edit</span>
                </a>
                <a href="{% url 'create_discount' appointment.id %}" class="btn-staff btn-discount" title="Gestionar Descuento">
                    <span class="material-icons">percent</span>
                </a>
                <a href="{% url 'delete_appointment' appointment.id %}" class="btn-staff btn-delete" title="Eliminar" onclick="return confirm('¿Estás seguro de que deseas eliminar este servicio?');">
                    <span class="material-icons">delete</span>
                </a>
            </div>
            {% endif %}

        </article>
        {% empty %}
            <p style="text-align: center; grid-column: 1/-1; padding: 50px;">No hay servicios disponibles en este momento.</p>
        {% endfor %}
    </div>

</div>
{% endblock contenido %}